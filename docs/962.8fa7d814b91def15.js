"use strict";(self.webpackChunktask_managment=self.webpackChunktask_managment||[]).push([[962],{8962:(J,p,a)=>{a.r(p),a.d(p,{AdminModule:()=>N});var g=a(6814),h=a(8948),e=a(5879),b=a(9372),f=a(5592),_=a(4664),x=a(2459),Z=a(891);let A=(()=>{class n{constructor(t){this.firestore=t}updateUserRole(t,s){return new f.y(r=>{let o={role:s};"user"===s?o.managedUsers=[]:"manager"===s&&(o.hasManager=!1),this.firestore.collection("users").doc(t).update(o).then(()=>"manager"===s?this.firestore.collection("users").ref.where("role","==","manager").get().then(i=>{const u=this.firestore.firestore.batch();return i.forEach(c=>{if(c.exists){const m=c.data().managedUsers||[],U=m.indexOf(t);U>-1&&(m.splice(U,1),u.update(c.ref,{managedUsers:m}))}}),u.commit()}):Promise.resolve()).then(()=>{r.next({message:"Role updated successfully"}),r.complete()}).catch(i=>{r.error(i)})})}deleteUser(t){return new f.y(s=>{this.firestore.doc(`users/${t}`).delete().then(()=>{this.firestore.collection("users").get().pipe((0,_.w)(r=>{const o=this.firestore.firestore.batch();return r.docs.forEach(i=>{const c=i.data().managedUsers||[],m=c.indexOf(t);-1!==m&&(c.splice(m,1),o.update(i.ref,{managedUsers:c}))}),(0,x.D)(o.commit())})).subscribe(()=>{s.next(),s.complete()},r=>{s.error(r)})}).catch(r=>{s.error(r)})})}static#e=this.\u0275fac=function(s){return new(s||n)(e.LFG(Z.ST))};static#t=this.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var M=a(4217),T=a(3354),d=a(6697);function v(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"button",14),e.NdJ("click",function(){e.CHM(t);const r=e.oxw().$implicit,o=e.oxw();return e.KtG(o.editUserRole(r,"user"))}),e._uU(1," User "),e.qZA()}}function w(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"button",14),e.NdJ("click",function(){e.CHM(t);const r=e.oxw().$implicit,o=e.oxw();return e.KtG(o.editUserRole(r,"manager"))}),e._uU(1," Manager "),e.qZA()}}function C(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"li")(1,"a",15),e.NdJ("click",function(){const o=e.CHM(t).$implicit,i=e.oxw(2).$implicit,u=e.oxw();return e.KtG(u.assignManager(i,o.id))}),e._uU(2),e.qZA()()}if(2&n){const t=l.$implicit;e.xp6(2),e.hij(" ",t.userName," ")}}function y(n,l){if(1&n&&(e.TgZ(0,"li")(1,"a",8),e._UZ(2,"i",9),e._uU(3," Assign Manager To \xa0 \xa0 \xbb"),e.qZA(),e.TgZ(4,"ul",10),e.YNc(5,C,3,1,"li",3),e.qZA()()),2&n){const t=e.oxw(2);e.xp6(5),e.Q6J("ngForOf",t.managableUsers)}}function S(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"tr")(1,"td",2)(2,"div",4)(3,"button",5),e._uU(4," Actions "),e._UZ(5,"i",6),e.qZA(),e.TgZ(6,"div",7)(7,"li")(8,"a",8),e._UZ(9,"i",9),e._uU(10," Edit Role To \xa0 \xa0 \xbb"),e.qZA(),e.TgZ(11,"ul",10)(12,"li"),e.YNc(13,v,2,0,"button",11),e.qZA(),e.TgZ(14,"li"),e.YNc(15,w,2,0,"button",11),e.qZA()()(),e.YNc(16,y,6,1,"li",12),e.TgZ(17,"a",13),e.NdJ("click",function(){const o=e.CHM(t).$implicit,i=e.oxw();return e.KtG(i.deleteUser(o.id))}),e._UZ(18,"i",9),e._uU(19," Delete "),e.qZA()()()(),e.TgZ(20,"td"),e._uU(21),e.qZA(),e.TgZ(22,"td"),e._uU(23),e.qZA(),e.TgZ(24,"td"),e._uU(25),e.qZA()()}if(2&n){const t=l.$implicit,s=e.oxw();e.xp6(13),e.Q6J("ngIf","user"!==t.role&&s.roleOptions.includes("user")),e.xp6(2),e.Q6J("ngIf","manager"!==t.role&&s.roleOptions.includes("manager")),e.xp6(1),e.Q6J("ngIf","manager"===t.role&&s.managableUsers.length>0),e.xp6(5),e.Oqu(t.email),e.xp6(2),e.Oqu(t.userName),e.xp6(2),e.Oqu(t.role)}}const F=[{path:"user-management",component:(()=>{class n{constructor(t,s,r,o){this.userService=t,this.adminService=s,this.managerService=r,this.message=o,this.users=[],this.userRole=null,this.roleOptions=["user","manager"],this.managableUsers=[]}ngOnInit(){this.userRole=localStorage.getItem("userRole"),this.getUsersAndManager(),this.loadManagableUsers()}getUsersAndManager(){this.userService.getUsers().subscribe(t=>{this.users=t.filter(s=>"admin"!==s.role)})}loadManagableUsers(){this.userService.getUsers().subscribe(t=>{this.managableUsers=t.filter(s=>"admin"!==s.role&&"manager"!==s.role&&0==s.hasManager)})}editUserRole(t,s){this.adminService.updateUserRole(t.id,s).subscribe({next:r=>{this.message.toast(r.message,"success")},error:r=>{this.message.toast(r,"error")}})}deleteUser(t){this.message.confirm("Delete!","Are you sure you want to delete it?","primary","question").then(s=>{s.isConfirmed&&this.adminService.deleteUser(t).subscribe({next:()=>{this.message.toast("User deleted successfully.","success")},error:r=>{this.message.toast(r,"error")}})})}assignManager(t,s){null===s?(t.managedUsers||[]).forEach(o=>{this.managerService.removeManagerFromUser(o,t.id).subscribe(()=>{this.message.toast("User removed Succesfully","success")},i=>{this.message.toast(i,"error")})}):this.managerService.addUserToManager(s,t.id).subscribe(o=>{console.log(o),this.message.toast("User Assigned Succesfully","success")},o=>{this.message.toast(o,"error")})}static#e=this.\u0275fac=function(s){return new(s||n)(e.Y36(b.K),e.Y36(A),e.Y36(M.b),e.Y36(T.e))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["app-user-management"]],decls:14,vars:1,consts:[[1,"table-responsive"],[1,"table","table-striped"],[1,"text-center"],[4,"ngFor","ngForOf"],["ngbDropdown","",1,"d-inline-block"],["type","button","id","actionDropdown","ngbDropdownToggle","",1,"btn","btn-sm","rounded-pill"],[1,"ri-more-2-fill"],["ngbDropdownMenu","","aria-labelledby","actionDropdown",1,"dropdown-menu"],[1,"btn","btn-sm","dropdown-item"],[1,"ri-chat-forward-line","align-bottom","me-2","text-muted"],[1,"dropdown-menu","dropdown-submenu"],["class","btn btn-sm dropdown-item",3,"click",4,"ngIf"],[4,"ngIf"],["role","button","ngbDropdownItem","",1,"btn","btn-sm","dropdown-item",3,"click"],[1,"btn","btn-sm","dropdown-item",3,"click"],["role","button",1,"dropdown-item",3,"click"]],template:function(s,r){1&s&&(e.TgZ(0,"div",0)(1,"table",1)(2,"thead")(3,"tr")(4,"th",2),e._uU(5,"Actions"),e.qZA(),e.TgZ(6,"th"),e._uU(7,"Email"),e.qZA(),e.TgZ(8,"th"),e._uU(9,"User Name"),e.qZA(),e.TgZ(10,"th"),e._uU(11,"Role"),e.qZA()()(),e.TgZ(12,"tbody"),e.YNc(13,S,26,6,"tr",3),e.qZA()()()),2&s&&(e.xp6(13),e.Q6J("ngForOf",r.users))},dependencies:[g.sg,g.O5,d.jt,d.iD,d.Vi,d.TH],styles:[".dropdown-menu li{position:relative}.dropdown-menu .dropdown-submenu{display:none;position:absolute;left:100%;top:-7px}.dropdown-menu .dropdown-submenu-left{right:100%;left:auto}.dropdown-menu>li:hover>.dropdown-submenu{display:block}.table-responsive{min-height:200px;margin-top:20px}\n"],encapsulation:2})}return n})()}];let O=(()=>{class n{static#e=this.\u0275fac=function(s){return new(s||n)};static#t=this.\u0275mod=e.oAB({type:n});static#s=this.\u0275inj=e.cJS({imports:[h.Bz.forChild(F),h.Bz]})}return n})();var D=a(6208);let N=(()=>{class n{static#e=this.\u0275fac=function(s){return new(s||n)};static#t=this.\u0275mod=e.oAB({type:n});static#s=this.\u0275inj=e.cJS({imports:[g.ez,O,D.m]})}return n})()}}]);